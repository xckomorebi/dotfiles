!function(){"use strict";const t=globalThis.chrome&&new function t(e){return new Proxy(e,{get:(e,n)=>"function"!=typeof e[n]?new t(e[n]):(...t)=>new Promise(((r,o)=>{e[n](...t,(t=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):r(t)}))}))})}(globalThis.chrome),e="object"==typeof chrome&&"scripting"in chrome;function n(t){return void 0===t?void 0:[t]}function r({tabId:r,frameId:o,files:s,allFrames:i,matchAboutBlank:a,runAt:c}){for(let l of s)"string"==typeof l&&(l={file:l}),e?chrome.scripting.insertCSS({target:{tabId:r,frameIds:n(o),allFrames:i},files:"file"in l?[l.file]:void 0,css:"code"in l?l.code:void 0}):t.tabs.insertCSS(r,{...l,matchAboutBlank:a,allFrames:i,frameId:o,runAt:null!=c?c:"document_start"})}async function o({tabId:r,frameId:o,files:s,allFrames:i,matchAboutBlank:a,runAt:c}){let l;for(let u of s)if("string"==typeof u&&(u={file:u}),e){if("code"in u)throw new Error("chrome.scripting does not support injecting strings of `code`");chrome.scripting.executeScript({target:{tabId:r,frameIds:n(o),allFrames:i},files:[u.file]})}else"code"in u&&await l,l=t.tabs.executeScript(r,{...u,matchAboutBlank:a,allFrames:i,frameId:o,runAt:c})}async function s(t,e){var n,s,i,a,c,l;const{frameId:u,tabId:m}="object"==typeof t?t:{tabId:t,frameId:0};for(const t of(f=e,Array.isArray(f)?f:[f]))r({tabId:m,frameId:u,files:null!==(n=t.css)&&void 0!==n?n:[],matchAboutBlank:null!==(s=t.matchAboutBlank)&&void 0!==s?s:t.match_about_blank,runAt:null!==(i=t.runAt)&&void 0!==i?i:t.run_at}),o({tabId:m,frameId:u,files:null!==(a=t.js)&&void 0!==a?a:[],matchAboutBlank:null!==(c=t.matchAboutBlank)&&void 0!==c?c:t.match_about_blank,runAt:null!==(l=t.runAt)&&void 0!==l?l:t.run_at});var f;await Promise.all([])}const i=globalThis.chrome&&new function t(e){return new Proxy(e,{get:(e,n)=>"function"!=typeof e[n]?new t(e[n]):(...t)=>new Promise(((r,o)=>{e[n](...t,(t=>{chrome.runtime.lastError?o(new Error(chrome.runtime.lastError.message)):r(t)}))}))})}(globalThis.chrome),a=/^(https?|wss?|file|ftp|\*):\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^file:\/\/\/.*$|^resource:\/\/(\*|\*\.[^*/]+|[^*/]+)\/.*$|^about:/,c="object"==typeof navigator&&navigator.userAgent.includes("Firefox/"),l=c?/^(https?|wss?):[/][/][^/]+([/].*)?$/:/^https?:[/][/][^/]+([/].*)?$/,u=/^(https?|file|ftp):[/]+/;function m(...t){return 0===t.length?/$./:t.includes("<all_urls>")?u:t.includes("*://*/*")?l:new RegExp(t.map((t=>function(t){if(!a.test(t))throw new Error(t+" is an invalid pattern, it must match "+String(a));let[,e,n,r]=t.split(/(^[^:]+:[/][/])([^/]+)?/);return e=e.replace("*",c?"(https?|wss?)":"https?").replace(/[/]/g,"[/]"),n=(null!=n?n:"").replace(/^[*][.]/,"([^/]+.)*").replace(/^[*]$/,"[^/]+").replace(/[.]/g,"[.]").replace(/[*]$/g,"[^.]+"),r=r.replace(/[/]/g,"[/]").replace(/[.]/g,"[.]").replace(/[*]/g,".*"),"^"+e+n+"("+r+")?$"}(t))).join("|"))}const f="object"==typeof chrome&&"webNavigation"in chrome;async function d(n,r){return async function(n,r,...o){const{frameId:s,tabId:i}=function(t){return"object"==typeof t?t:{tabId:t,frameId:0}}(n);if(e){const[t]=await chrome.scripting.executeScript({target:{tabId:i,frameIds:[s]},func:r,args:o});return null==t?void 0:t.result}const[a]=await t.tabs.executeScript(i,{code:`(${r.toString()})(...${JSON.stringify(o)})`,frameId:s});return a}(n,(t=>{const e=document[t];return document[t]=!0,e}),JSON.stringify(r))}function p(){return function(t){var e,n,r;const o={origins:[],permissions:[]},s=new Set([...null!==(e=t.permissions)&&void 0!==e?e:[],...(null!==(n=t.content_scripts)&&void 0!==n?n:[]).flatMap((t=>{var e;return null!==(e=t.matches)&&void 0!==e?e:[]}))]);t.devtools_page&&!(null===(r=t.optional_permissions)||void 0===r?void 0:r.includes("devtools"))&&s.add("devtools");for(const t of s)t.includes("://")?o.origins.push(t):o.permissions.push(t);return o}(chrome.runtime.getManifest())}const h=/:[/][/][*.]*([^/]+)/;function g(t){return t.split(h)[1]}async function b(t){return new Promise((e=>{chrome.permissions.getAll((n=>{const r=p();e(function(t,e,{strictOrigins:n=!0}={}){var r,o;const s={origins:[],permissions:[]};for(const o of null!==(r=e.origins)&&void 0!==r?r:[])if(!t.origins.includes(o)){if(!n){const e=g(o);if(t.origins.some((t=>g(t)===e)))continue}s.origins.push(o)}for(const n of null!==(o=e.permissions)&&void 0!==o?o:[])t.permissions.includes(n)||s.permissions.push(n);return s}(r,n,t))}))}))}var v,w,y;const I=new Map,A=null!==(y=null===(w=null===(v=null===globalThis||void 0===globalThis?void 0:globalThis.browser)||void 0===v?void 0:v.contentScripts)||void 0===w?void 0:w.register)&&void 0!==y?y:async function(t,e){const{js:n=[],css:s=[],matchAboutBlank:a,matches:c,excludeMatches:l,runAt:u}=t;let{allFrames:p}=t;f?p=!1:p&&console.warn("`allFrames: true` requires the `webNavigation` permission to work correctly: https://github.com/fregante/content-scripts-register-polyfill#permissions");const h=m(...c),g=m(...null!=l?l:[]),b=async(t,e,c=0)=>{h.test(t)&&!g.test(t)&&await async function(t){return i.permissions.contains({origins:[new URL(t).origin+"/*"]})}(t)&&!await d({tabId:e,frameId:c},{js:n,css:s})&&(r({tabId:e,frameId:c,files:s,matchAboutBlank:a,runAt:u}),await o({tabId:e,frameId:c,files:n,matchAboutBlank:a,runAt:u}))},v=async(t,{status:e},{url:n})=>{e&&n&&b(n,t)},w=async({tabId:t,frameId:e,url:n})=>{b(n,t,e)};f?chrome.webNavigation.onCommitted.addListener(w):chrome.tabs.onUpdated.addListener(v);const y={async unregister(){f?chrome.webNavigation.onCommitted.removeListener(w):chrome.tabs.onUpdated.removeListener(v)}};return"function"==typeof e&&e(y),y};function k(t){return{file:new URL(t,location.origin).pathname}}async function S({origins:t}){const e=chrome.runtime.getManifest().content_scripts;if(!e)throw new Error("webext-dynamic-content-scripts tried to register scripts on th new host permissions, but no content scripts were found in the manifest.");for(const n of t||[])for(const t of e){const e=A({js:(t.js||[]).map((t=>k(t))),css:(t.css||[]).map((t=>k(t))),allFrames:t.all_frames,matches:[n],excludeMatches:t.matches,runAt:t.run_at});I.set(n,e)}var n,r;r=e,0!==(n=t||[]).length&&chrome.tabs.query({url:n},(t=>{for(const e of t)e.id&&s(e.id,r)}))}(async()=>{S(await b({strictOrigins:!1}))})(),chrome.permissions.onAdded.addListener((t=>{t.origins&&t.origins.length>0&&S(t)})),chrome.permissions.onRemoved.addListener((async({origins:t})=>{if(t&&0!==t.length)for(const[e,n]of I)t.includes(e)&&(await n).unregister()}))}();